From 13ae7e15bc0b8012b910273d2857f3e6989e6325 Mon Sep 17 00:00:00 2001
From: Joachim Breitner <mail@joachim-breitner.de>
Date: Wed, 26 May 2021 13:51:55 +0000
Subject: [PATCH] pkgsMusl.ocamlPackages.ocaml: Disable pie hardening on musl

This was broken since 4e9dc46d, and fixes #124476
---
 pkgs/development/compilers/ocaml/generic.nix | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/pkgs/development/compilers/ocaml/generic.nix b/pkgs/development/compilers/ocaml/generic.nix
index d9853dd642a..ccf56140cf3 100644
--- a/pkgs/development/compilers/ocaml/generic.nix
+++ b/pkgs/development/compilers/ocaml/generic.nix
@@ -58,6 +58,9 @@ stdenv.mkDerivation (args // {
   ++ optional spaceTimeSupport (flags "--enable-spacetime" "-spacetime")
   ;
 
+  hardeningDisable = stdenv.lib.optional stdenv.targetPlatform.isMusl "pie";
+
+
   buildFlags = [ "world" ] ++ optionals useNativeCompilers [ "bootstrap" "world.opt" ];
   buildInputs = optional (!lib.versionAtLeast version "4.07") ncurses
     ++ optionals useX11 [ libX11 xorgproto ];
-- 
2.29.2

